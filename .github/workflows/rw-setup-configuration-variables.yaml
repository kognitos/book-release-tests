name: "Setup Configuration Variables"

on:
  workflow_call:
    inputs:
      CONFIG_FILE_PATH:
        required: false
        type: string
        default: "./book-config.yaml"
    
    outputs:
      BOOK_NAME:
        value: ${{ jobs.LoadVariables.outputs.BOOK_NAME }}
      BDK_RUNTIME_VERSION:
        value: ${{ jobs.LoadVariables.outputs.BDK_RUNTIME_VERSION }}
      AWS_ACCOUNT_ID:
        value: ${{ jobs.LoadVariables.outputs.AWS_ACCOUNT_ID }}
      AWS_REGION:
        value: ${{ jobs.LoadVariables.outputs.AWS_REGION }}
      DOCKER_REGISTRY:
        value: ${{ jobs.LoadVariables.outputs.DOCKER_REGISTRY }}
      TERRAFORM_BACKEND_BUCKET_NAME:
        value: ${{ jobs.LoadVariables.outputs.TERRAFORM_BACKEND_BUCKET_NAME }}

jobs:
  LoadVariables:
    runs-on: ubuntu-latest
    outputs:
      BOOK_NAME: ${{ steps.vars.outputs.BOOK_NAME }}
      BDK_RUNTIME_VERSION: ${{ jobs.LoadVariables.outputs.BDK_RUNTIME_VERSION }}
      AWS_ACCOUNT_ID: ${{ steps.vars.outputs.AWS_ACCOUNT_ID }}
      AWS_REGION: ${{ steps.vars.outputs.AWS_REGION }}
      DOCKER_REGISTRY: ${{ steps.vars.outputs.DOCKER_REGISTRY }}
      TERRAFORM_BACKEND_BUCKET_NAME: ${{ steps.vars.outputs.TERRAFORM_BACKEND_BUCKET_NAME }}
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: 3.12
      - shell: bash
        run: pip install pyyaml toml
      - shell: bash
        id: vars
        run: python ./.github/scripts/setup.py ${{ inputs.CONFIG_FILE_PATH }}
